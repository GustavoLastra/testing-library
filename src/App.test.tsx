import React from 'react';

//import App from './App';
import {setupServer} from "msw/node";
import {render, fireEvent, waitFor, screen} from '@testing-library/react'
import {rest} from "msw";
import {BASE_URL} from "./CocktailService";
import App from "./App";

// declare which API requests to mock
const server = setupServer(
    rest.get(`${BASE_URL}/search.php`, (req, res, ctx) => {
        req.url.searchParams.getAll('s')
        // respond using a mocked JSON body
        return res(ctx.json(drinksMocked))
    }),
)

beforeAll(() => server.listen())
afterEach(() => server.resetHandlers())
afterAll(() => server.close())

test('loads and displays greeting', async () => {
    // Arrange
    render(<App />)

    // Act
    fireEvent.click(screen.getByText('Load Tequila Cocktails'))
    await waitFor(() => screen.findAllByRole('article'))

    // Assert
    expect(screen.getByRole('button')).toHaveTextContent('Loaded')
    expect(screen.getByRole('button')).toBeDisabled()
})

const drinksMocked = {"drinks":[{"idDrink":"12362","strDrink":"Tequila Fizz","strDrinkAlternate":null,"strTags":null,"strVideo":null,"strCategory":"Ordinary Drink","strIBA":null,"strAlcoholic":"Alcoholic","strGlass":"Collins glass","strInstructions":"Shake all ingredients (except ginger ale) with ice and strain into a collins glass over ice cubes. Fill with ginger ale, stir, and serve.","strInstructionsES":null,"strInstructionsDE":"Alle Zutaten (au\u00dfer Ginger Ale) mit Eis sch\u00fctteln und in ein Collins-Glas \u00fcber Eisw\u00fcrfel abseihen. Mit Ginger Ale f\u00fcllen, umr\u00fchren und servieren.","strInstructionsFR":null,"strInstructionsIT":"Shakerare tutti gli ingredienti (eccetto ginger ale) con ghiaccio e filtrare in un bicchiere Collins con cubetti di ghiaccio.Riempi con ginger ale, mescola e servi.","strInstructionsZH-HANS":null,"strInstructionsZH-HANT":null,"strDrinkThumb":"https:\/\/www.thecocktaildb.com\/images\/media\/drink\/2bcase1504889637.jpg","strIngredient1":"Tequila","strIngredient2":"Lemon juice","strIngredient3":"Grenadine","strIngredient4":"Egg white","strIngredient5":"Ginger ale","strIngredient6":null,"strIngredient7":null,"strIngredient8":null,"strIngredient9":null,"strIngredient10":null,"strIngredient11":null,"strIngredient12":null,"strIngredient13":null,"strIngredient14":null,"strIngredient15":null,"strMeasure1":"2 oz ","strMeasure2":"1 tblsp ","strMeasure3":"3\/4 oz ","strMeasure4":"1 ","strMeasure5":null,"strMeasure6":null,"strMeasure7":null,"strMeasure8":null,"strMeasure9":null,"strMeasure10":null,"strMeasure11":null,"strMeasure12":null,"strMeasure13":null,"strMeasure14":null,"strMeasure15":null,"strImageSource":null,"strImageAttribution":null,"strCreativeCommonsConfirmed":"No","dateModified":"2017-09-08 17:53:57"},{"idDrink":"12370","strDrink":"Tequila Sour","strDrinkAlternate":null,"strTags":null,"strVideo":null,"strCategory":"Ordinary Drink","strIBA":null,"strAlcoholic":"Alcoholic","strGlass":"Whiskey sour glass","strInstructions":"Shake tequila, juice of lemon, and powdered sugar with ice and strain into a whiskey sour glass. Add the half-slice of lemon, top with the cherry, and serve.","strInstructionsES":null,"strInstructionsDE":"Tequila, Zitronensaft und Puderzucker mit Eis sch\u00fctteln und in ein Whiskey-Sourglas abseihen. Die halbe Zitronenscheibe dazugeben, mit der Kirsche garnieren und servieren.","strInstructionsFR":null,"strInstructionsIT":"Shakerare la tequila, il succo di limone e lo zucchero a velo con ghiaccio e filtrare in un bicchiere da whisky sour.Aggiungere la mezza fetta di limone, guarnire con la ciliegia e servire.","strInstructionsZH-HANS":null,"strInstructionsZH-HANT":null,"strDrinkThumb":"https:\/\/www.thecocktaildb.com\/images\/media\/drink\/ek0mlq1504820601.jpg","strIngredient1":"Tequila","strIngredient2":"Lemon","strIngredient3":"Powdered sugar","strIngredient4":"Lemon","strIngredient5":"Cherry","strIngredient6":null,"strIngredient7":null,"strIngredient8":null,"strIngredient9":null,"strIngredient10":null,"strIngredient11":null,"strIngredient12":null,"strIngredient13":null,"strIngredient14":null,"strIngredient15":null,"strMeasure1":"2 oz ","strMeasure2":"Juice of 1\/2 ","strMeasure3":"1 tsp ","strMeasure4":"1\/2 slice ","strMeasure5":"1 ","strMeasure6":null,"strMeasure7":null,"strMeasure8":null,"strMeasure9":null,"strMeasure10":null,"strMeasure11":null,"strMeasure12":null,"strMeasure13":null,"strMeasure14":null,"strMeasure15":null,"strImageSource":null,"strImageAttribution":null,"strCreativeCommonsConfirmed":"No","dateModified":"2017-09-07 22:43:21"},{"idDrink":"13621","strDrink":"Tequila Sunrise","strDrinkAlternate":null,"strTags":"IBA,ContemporaryClassic","strVideo":null,"strCategory":"Cocktail","strIBA":"Contemporary Classics","strAlcoholic":"Alcoholic","strGlass":"Highball glass","strInstructions":"Pour the tequila and orange juice into glass over ice. Add the grenadine, which will sink to the bottom. Stir gently to create the sunrise effect. Garnish and serve.","strInstructionsES":null,"strInstructionsDE":"Den Tequila und den Orangensaft in ein Glas \u00fcber Eis gie\u00dfen. F\u00fcge die Grenadine hinzu, die auf den Boden sinken wird. R\u00fchren Sie sanft um, um den Sonnenaufgangseffekt zu erzeugen. Garnieren und servieren.","strInstructionsFR":null,"strInstructionsIT":"Versare la tequila e il succo d'arancia in un bicchiere con ghiaccio.\r\nAggiungere la granatina, che affonder\u00e0 sul fondo.\r\nMescola delicatamente per creare l'effetto alba.\r\nGuarnire e servire.","strInstructionsZH-HANS":null,"strInstructionsZH-HANT":null,"strDrinkThumb":"https:\/\/www.thecocktaildb.com\/images\/media\/drink\/quqyqp1480879103.jpg","strIngredient1":"Tequila","strIngredient2":"Orange juice","strIngredient3":"Grenadine","strIngredient4":null,"strIngredient5":null,"strIngredient6":null,"strIngredient7":null,"strIngredient8":null,"strIngredient9":null,"strIngredient10":null,"strIngredient11":null,"strIngredient12":null,"strIngredient13":null,"strIngredient14":null,"strIngredient15":null,"strMeasure1":"2 measures ","strMeasure2":null,"strMeasure3":null,"strMeasure4":null,"strMeasure5":null,"strMeasure6":null,"strMeasure7":null,"strMeasure8":null,"strMeasure9":null,"strMeasure10":null,"strMeasure11":null,"strMeasure12":null,"strMeasure13":null,"strMeasure14":null,"strMeasure15":null,"strImageSource":null,"strImageAttribution":null,"strCreativeCommonsConfirmed":"No","dateModified":"2016-12-04 19:18:23"},{"idDrink":"178307","strDrink":"Tequila Slammer","strDrinkAlternate":null,"strTags":"Drunk","strVideo":null,"strCategory":"Shot","strIBA":null,"strAlcoholic":"Alcoholic","strGlass":"Hurricane glass","strInstructions":"Mix carefully to avoid releasing the dissolved CO2.","strInstructionsES":null,"strInstructionsDE":null,"strInstructionsFR":null,"strInstructionsIT":"Mescolare accuratamente per evitare di rilasciare la CO2 disciolta.","strInstructionsZH-HANS":null,"strInstructionsZH-HANT":null,"strDrinkThumb":"https:\/\/www.thecocktaildb.com\/images\/media\/drink\/43uhr51551451311.jpg","strIngredient1":"Tequila","strIngredient2":"7-up","strIngredient3":null,"strIngredient4":null,"strIngredient5":null,"strIngredient6":null,"strIngredient7":null,"strIngredient8":null,"strIngredient9":null,"strIngredient10":null,"strIngredient11":null,"strIngredient12":null,"strIngredient13":null,"strIngredient14":null,"strIngredient15":null,"strMeasure1":"1 shot","strMeasure2":"1 part","strMeasure3":null,"strMeasure4":null,"strMeasure5":null,"strMeasure6":null,"strMeasure7":null,"strMeasure8":null,"strMeasure9":null,"strMeasure10":null,"strMeasure11":null,"strMeasure12":null,"strMeasure13":null,"strMeasure14":null,"strMeasure15":null,"strImageSource":null,"strImageAttribution":null,"strCreativeCommonsConfirmed":"No","dateModified":null},{"idDrink":"14602","strDrink":"Tequila Surprise","strDrinkAlternate":null,"strTags":null,"strVideo":null,"strCategory":"Shot","strIBA":null,"strAlcoholic":"Alcoholic","strGlass":"Shot glass","strInstructions":"Fill shot glass with Tequila. Add drops of Tobasco sauce.","strInstructionsES":null,"strInstructionsDE":"F\u00fcllen Sie das Schnapsglas mit Tequila. F\u00fcge Tropfen Tobasco-Sauce hinzu.","strInstructionsFR":null,"strInstructionsIT":"Riempi un bicchierino da shot con la tequila.\r\nAggiungere le gocce di salsa Tabasco.","strInstructionsZH-HANS":null,"strInstructionsZH-HANT":null,"strDrinkThumb":"https:\/\/www.thecocktaildb.com\/images\/media\/drink\/8189p51504735581.jpg","strIngredient1":"Tequila","strIngredient2":"Tabasco sauce","strIngredient3":null,"strIngredient4":null,"strIngredient5":null,"strIngredient6":null,"strIngredient7":null,"strIngredient8":null,"strIngredient9":null,"strIngredient10":null,"strIngredient11":null,"strIngredient12":null,"strIngredient13":null,"strIngredient14":null,"strIngredient15":null,"strMeasure1":"full glass ","strMeasure2":"About 8 drops ","strMeasure3":null,"strMeasure4":null,"strMeasure5":null,"strMeasure6":null,"strMeasure7":null,"strMeasure8":null,"strMeasure9":null,"strMeasure10":null,"strMeasure11":null,"strMeasure12":null,"strMeasure13":null,"strMeasure14":null,"strMeasure15":null,"strImageSource":null,"strImageAttribution":null,"strCreativeCommonsConfirmed":"No","dateModified":"2017-09-06 23:06:21"}]}
